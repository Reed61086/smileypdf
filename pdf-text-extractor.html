<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Text Extractor</title>
    <!-- Base CDNs -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Additional Libraries from Source File (Violates Original Constraints) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script> <!-- Added Mammoth -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> <!-- Font Awesome (from source) -->
    <style>
        .file-upload-container {
            border: 2px dashed #93C5FD;
            transition: all 0.3s ease;
        }
        .file-upload-container:hover {
            border-color: #3B82F6;
            background-color: #EFF6FF;
        }
        .file-upload-container.drag-over {
            border-color: #2563EB;
            background-color: #DBEAFE;
        }
        .option-card {
            transition: all 0.3s ease;
        }
        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .option-card.selected {
            border-color: #3B82F6;
            background-color: #EFF6FF;
        }
        #progressBar {
            transition: width 0.5s ease;
        }
        .ocr-watermark {
            position: relative;
        }
        .ocr-watermark::after {
            content: "OCR Processed";
            position: absolute;
            opacity: 0.1;
            font-size: 3rem;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            z-index: 0;
            color: #3B82F6;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
 <!-- Header -->
 <header x-data="{ mobileMenuOpen: false }" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white shadow-md sticky top-0 z-50"> <!-- Blue gradient -->
    <nav class="container mx-auto px-4 sm:px-6 py-1 flex justify-between items-center">
        <!-- Logo Link -->
        <a href="index.html" class="flex items-center transition duration-150 ease-in-out hover:opacity-80">
           <img src="logo.png" alt="SmileyPDF Logo" class="h-20 w-auto mr-2"> <!-- NEW: Doubled size -->
        </a>

        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-4">
            <a href="index.html" class="hover:text-blue-200 font-medium px-3 py-2 rounded-md text-sm">Home</a>
            <!-- Tools Dropdown -->
             <div class="relative" x-data="{ open: false }">
                <button @click="open = !open" @keydown.escape.window="open = false" class="hover:text-blue-200 font-medium focus:outline-none flex items-center px-3 py-2 rounded-md text-sm">
                    Tools <i class="fas fa-chevron-down ml-1 text-xs"></i>
                </button>
                <div x-show="open" @click.away="open = false"
                     x-transition:enter="transition ease-out duration-100 transform"
                     x-transition:enter-start="opacity-0 scale-95"
                     x-transition:enter-end="opacity-100 scale-100"
                     x-transition:leave="transition ease-in duration-75 transform"
                     x-transition:leave-start="opacity-100 scale-100"
                     x-transition:leave-end="opacity-0 scale-95"
                     class="absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-20 text-gray-700 py-1 origin-top-right"
                     style="display: none;" x-cloak>
                     <a href="pdf-editor.html" class="block px-4 py-2 text-sm hover:bg-gray-100">PDF Editor</a>
                     <a href="merge-pdf.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Merge PDF</a>
                     <a href="image-to-pdf.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Image to PDF</a>
                     <a href="pdf-rotator.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Rotate PDF</a>
                     <a href="pdf-text-extractor.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Extract PDF Text</a>
                     <a href="pdf-to-jpg.html" class="block px-4 py-2 text-sm hover:bg-gray-100">PDF to JPG</a>
                     <a href="pdf-to-word.html" class="block px-4 py-2 text-sm hover:bg-gray-100">PDF to Word</a>
                 </div>
             </div>
         </div>
          <!-- Mobile Menu Button -->
          <div class="md:hidden">
              <button @click="mobileMenuOpen = !mobileMenuOpen" class="text-white focus:outline-none p-2 rounded hover:bg-blue-600">
                  <span class="sr-only">Open menu</span>
                  <i x-show="!mobileMenuOpen" class="fa-solid fa-bars text-xl"></i>
                  <i x-show="mobileMenuOpen" class="fa-solid fa-times text-xl" style="display: none;" x-cloak></i>
              </button>
         </div>
    </nav>
     <!-- Mobile Menu Panel -->
     <div x-show="mobileMenuOpen"
         @click.away="mobileMenuOpen = false"
         class="md:hidden absolute inset-x-0 top-full bg-blue-600 shadow-lg border-t border-blue-500"
         x-transition:enter="transition ease-out duration-200 transform origin-top"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75 transform origin-top"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         style="display: none;" x-cloak>
        <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
            <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Home</a>
            <h3 class="px-3 pt-4 pb-1 text-xs font-semibold text-blue-200 uppercase tracking-wider">Tools</h3>
            <a href="pdf-editor.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">PDF Editor</a>
            <a href="merge-pdf.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Merge PDF</a>
            <a href="image-to-pdf.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Image to PDF</a>
            <a href="pdf-rotator.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Rotate PDF</a>
            <a href="pdf-text-extractor.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Extract PDF Text</a>
            <a href="pdf-to-jpg.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">PDF to JPG</a>
            <a href="pdf-to-word.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">PDF to Word</a>
        </div>
     </div>
</header>
    <div class="container mx-auto px-4 py-12">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-10">
                <h1 class="text-4xl font-bold text-gray-800 mb-3">PDF Text Extractor</h1>
                <p class="text-gray-600">Upload your PDF document and extract text with various options</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="file-upload-container rounded-lg p-8 text-center cursor-pointer" id="dropZone">
                    <i class="fas fa-file-pdf text-6xl text-blue-500 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Upload PDF Document</h3>
                    <p class="text-gray-500 mb-4">Drag & drop your PDF file here or click to browse</p>
                    <input type="file" id="pdfInput" accept=".pdf" class="hidden">
                    <button id="uploadBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition duration-300">
                        <i class="fas fa-upload mr-2"></i> Select PDF File
                    </button>
                    <p id="fileName" class="mt-3 text-sm text-gray-500 hidden"></p>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Choose Extraction Options</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="option-card p-5 border rounded-lg cursor-pointer bg-white shadow-sm" data-option="formatting">
                        <div class="flex items-start">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-4">
                                <i class="fas fa-align-left text-blue-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 mb-1">Maintain Formatting</h4>
                                <p class="text-gray-600 text-sm">Conversion to Word document. Formatting will be maintained if possible.</p>
                            </div>
                        </div>
                    </div>
                    <div class="option-card p-5 border rounded-lg cursor-pointer bg-white shadow-sm" data-option="text">
                        <div class="flex items-start">
                            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-4">
                                <i class="fas fa-file-alt text-green-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 mb-1">Extract Text (Best for true PDFs)</h4>
                                <p class="text-gray-600 text-sm">If in true PDF format, we'll extract the text. Best option if you just need the text.</p>
                            </div>
                        </div>
                    </div>
                    <div class="option-card p-5 border rounded-lg cursor-pointer bg-white shadow-sm" data-option="ocr">
                        <div class="flex items-start">
                            <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-4">
                                <i class="fas fa-eye text-purple-600"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-800 mb-1">OCR for Scanned PDFs</h4>
                                <p class="text-gray-600 text-sm">If the PDF is from a scanned document, we'll extract text using OCR. Formatting is not maintained.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="processingSection" class="hidden bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Processing PDF</h3>
                    <div id="progressText" class="text-sm text-gray-500">0%</div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <div id="statusMessage" class="mt-2 text-sm text-gray-500"></div>
            </div>

            <div id="resultSection" class="hidden bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-800">Extracted Contents</h3>
                    <div>
                        <button id="copyBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1.5 px-4 rounded-lg text-sm transition duration-300 mr-2">
                            <i class="fas fa-copy mr-2"></i> Copy
                        </button>
                        <button id="downloadBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-1.5 px-4 rounded-lg text-sm transition duration-300">
                            <i class="fas fa-download mr-2"></i> Download
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div id="extractedText" class="text-gray-800 whitespace-pre-line max-h-96 overflow-y-auto border border-gray-200 p-4 rounded bg-gray-50"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const pdfInput = document.getElementById('pdfInput');
            const uploadBtn = document.getElementById('uploadBtn');
            const dropZone = document.getElementById('dropZone');
            const fileName = document.getElementById('fileName');
            const optionCards = document.querySelectorAll('.option-card');
            const processingSection = document.getElementById('processingSection');
            const resultSection = document.getElementById('resultSection');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const statusMessage = document.getElementById('statusMessage');
            const extractedText = document.getElementById('extractedText');
            const downloadBtn = document.getElementById('downloadBtn');
            const copyBtn = document.getElementById('copyBtn');

            let selectedOption = 'text'; // Default option
            let currentFile = null;
            let extractedContentCache = ''; // Store the result for download/copy

            // Set PDF.js worker path
             // Check if libraries exist
             if (typeof window.pdfjsLib === 'undefined') {
                alert('Error: pdf.js library not loaded. Cannot proceed.');
                console.error('pdf.js library not found.');
                return; // Prevent further execution
             }
             if (typeof window.saveAs === 'undefined') {
                 console.warn('FileSaver.js not loaded. Download functionality might be limited.');
                 // Don't necessarily stop, maybe fallback to data URI download?
             }
             if (typeof window.mammoth === 'undefined') {
                 console.warn('Mammoth.js not loaded. Maintain Formatting (to Word) might not work correctly.');
             }

            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';


            // Option card selection
            optionCards.forEach(card => {
                card.addEventListener('click', function() {
                    optionCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedOption = this.getAttribute('data-option');
                });
            });

            // Default selection
            document.querySelector('.option-card[data-option="text"]').classList.add('selected');

            // Upload button click
            uploadBtn.addEventListener('click', function() {
                pdfInput.click();
            });

             // Click on dropzone activates file input
             dropZone.addEventListener('click', function(e) {
                if(e.target === dropZone || dropZone.contains(e.target) && !e.target.closest('button, input')){
                     pdfInput.click();
                 }
            });

            // File input change
            pdfInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });

            // Drag and drop events
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                if (e.dataTransfer.files.length > 0 && e.dataTransfer.files[0].type === 'application/pdf') {
                    handleFileUpload(e.dataTransfer.files[0]);
                } else {
                    alert('Please upload a valid PDF file');
                }
            });

            // Copy button
            copyBtn.addEventListener('click', function() {
                if (extractedContentCache) {
                    navigator.clipboard.writeText(extractedContentCache)
                        .then(() => {
                            const originalText = copyBtn.innerHTML;
                            copyBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Copied!';
                            setTimeout(() => {
                                copyBtn.innerHTML = originalText;
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Failed to copy text: ', err);
                            alert('Failed to copy text. Please try selecting and copying manually.');
                        });
                } else {
                     alert('No text content available to copy.');
                }
            });

            // Handle file upload
            function handleFileUpload(file) {
                currentFile = file;
                fileName.textContent = `File: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
                fileName.classList.remove('hidden');

                // Show processing section, hide results
                processingSection.classList.remove('hidden');
                resultSection.classList.add('hidden');
                updateProgress(0);
                statusMessage.textContent = 'Initializing...';
                extractedText.textContent = ''; // Clear previous results
                extractedText.classList.remove('ocr-watermark'); // Remove OCR style

                // Use setTimeout to allow UI repaint before processing
                setTimeout(() => {
                    processPDF(file);
                }, 100);
            }

            function updateProgress(value) {
                const percentage = Math.min(100, Math.max(0, value)); // Clamp value between 0-100
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `${Math.round(percentage)}%`;
            }

            async function processPDF(file) {
                try {
                    extractedContentCache = ''; // Clear cache
                    let finalFilename = currentFile.name.replace(/\.pdf$/i, ''); // Prepare filename without extension

                    const arrayBuffer = await file.arrayBuffer(); // Read file only once

                    if (selectedOption === 'formatting') {
                         // Client-side Word conversion is complex. Using mammoth.js might work if it was DOCX -> HTML
                         // Here, we'll use pdf.js text extraction and simulate formatting, then save as TXT for demo.
                        statusMessage.textContent = 'Extracting text content...';
                        updateProgress(20);
                         const rawText = await extractTextFromPDFjs(arrayBuffer);
                        extractedContentCache = simulateWordFormatting(rawText);
                        finalFilename += '_formatted.txt'; // Changed to txt for this demo
                        statusMessage.textContent = 'Simulating formatting...';
                         updateProgress(90);
                        extractedText.textContent = extractedContentCache || "Failed to simulate formatting.";


                    } else if (selectedOption === 'ocr') {
                        // Client-side OCR is generally *very* heavy or requires external APIs/libraries not included (e.g., Tesseract.js)
                        // For this demo, we simulate by just extracting text and adding "OCR" marker.
                        statusMessage.textContent = 'Simulating OCR process (extracting regular text)...';
                        updateProgress(20);
                        extractedContentCache = await extractTextFromPDFjs(arrayBuffer);
                        extractedText.classList.add('ocr-watermark');
                        finalFilename += '_ocr.txt';
                         updateProgress(90);
                        extractedText.textContent = extractedContentCache || "OCR Simulation Failed (no text found).";

                    } else { // Default: 'text' extraction
                        statusMessage.textContent = 'Extracting text content...';
                        updateProgress(20);
                        extractedContentCache = await extractTextFromPDFjs(arrayBuffer);
                         finalFilename += '_extracted.txt';
                         updateProgress(90);
                        extractedText.textContent = extractedContentCache || "No text could be extracted.";
                        extractedText.classList.remove('ocr-watermark');
                    }

                     // Final UI update
                     setTimeout(() => {
                        updateProgress(100);
                         statusMessage.textContent = 'Processing complete.';
                        processingSection.classList.add('hidden');
                         resultSection.classList.remove('hidden');
                     }, 300);

                    // Setup download
                    downloadBtn.onclick = function() {
                        try {
                             // Always save as text in this simplified version
                            const blob = new Blob([extractedContentCache], { type: 'text/plain;charset=utf-8' });
                            if(typeof window.saveAs !== 'undefined') {
                                 saveAs(blob, finalFilename);
                             } else {
                                // Fallback download method
                                const link = document.createElement("a");
                                link.href = URL.createObjectURL(blob);
                                link.download = finalFilename;
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                URL.revokeObjectURL(link.href);
                             }
                         } catch(e) {
                             console.error("Download error:", e);
                             alert("Failed to initiate download.");
                         }
                    };

                } catch (error) {
                    console.error('Error processing PDF:', error);
                    statusMessage.textContent = 'Error processing PDF: ' + error.message;
                    extractedText.textContent = "Error processing PDF. Please try again.";
                    processingSection.classList.add('hidden');
                    resultSection.classList.remove('hidden'); // Show result section even on error to display message
                     updateProgress(0);
                }
            }


             // PDF text extraction using pdf.js
             async function extractTextFromPDFjs(typedarray) {
                 const loadingTask = pdfjsLib.getDocument(typedarray);
                 const pdf = await loadingTask.promise;
                 let fullText = '';
                 const totalPages = pdf.numPages;

                  updateProgress(30); // Start progress after loading

                  for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                      const page = await pdf.getPage(pageNum);
                      const textContent = await page.getTextContent();
                      const pageText = textContent.items.map(item => item.str).join(' ');
                      fullText += `Page ${pageNum}:\n${pageText}\n\n--------------------------------------------------\n\n`;

                      // Update progress based on page processed
                      const progress = 30 + (pageNum / totalPages) * 60;
                      updateProgress(progress);
                     // Small delay for UI responsiveness if many pages
                     if(pageNum % 10 === 0) {
                          await new Promise(resolve => setTimeout(resolve, 5));
                     }
                 }
                 return fullText;
             }

             // Simulate applying some basic structure often lost in raw text extraction
              function simulateWordFormatting(text) {
                  let formatted = '';
                  const lines = text.split('\n');
                  let inHeader = false;
                  lines.forEach(line => {
                      const trimmed = line.trim();
                      if(trimmed.length === 0) {
                          if(!formatted.endsWith('\n\n')) formatted += '\n'; // Keep single empty lines
                          inHeader = false;
                          return;
                       }
                      // Try to detect headers (simple version: ALL CAPS, short line)
                      if (/^[A-Z\s.,'-]{5,50}$/.test(trimmed) && trimmed.length < 50 && !inHeader) {
                           formatted += '\n## ' + trimmed + '\n\n';
                          inHeader = true;
                       }
                      // Try to detect list items
                      else if (/^\s*[-*•o]\s+/.test(line)) {
                           formatted += '- ' + trimmed.substring(trimmed.indexOf(' ') + 1) + '\n';
                          inHeader = false;
                      }
                      // Simple paragraph structure
                      else {
                           formatted += trimmed + ' '; // Join lines within a potential paragraph
                          // Add newline if sentence seems to end
                          if(/[.?!]$/.test(trimmed)) {
                             formatted += '\n';
                          }
                          inHeader = false;
                       }
                  });
                  return formatted.replace(/\s\n/g, '\n').replace(/\n+/g, '\n\n'); // Clean up extra spaces/newlines
             }
         });
     </script>
     <!-- Ad Block -->
    <div class="w-full max-w-4xl mx-auto my-8 text-center">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9273434855071552"
             crossorigin="anonymous"></script>
        <!-- Reed -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-9273434855071552"
             data-ad-slot="6257062799"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
</body>
</html>