<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to Word Converter</title>
    <!-- Base CDNs -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Additional Libraries from Source File (Violates Original Constraints) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        .dropzone {
            border: 2px dashed #ccc;
            transition: all 0.3s ease;
        }
        .dropzone.active {
            border-color: #3b82f6;
            background-color: #f0f7ff;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        #pdfjs-container {
            position: absolute;
            left: -9999px;
            visibility: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
<!-- Header -->
 <header x-data="{ mobileMenuOpen: false }" class="bg-gradient-to-r from-cyan-500 to-blue-600 text-white shadow-md sticky top-0 z-50">
    <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
        <div class="text-2xl font-bold">
             <a href="index.html" class="flex items-center transition duration-150 ease-in-out hover:opacity-80">
                <i class="fa-regular fa-face-smile mr-2 text-yellow-300"></i>SmileyPDF
             </a>
        </div>
        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-4">
            <a href="index.html" class="hover:text-yellow-300 font-semibold px-3 py-2 rounded-md">Home</a>
            <!-- Tools Dropdown -->
             <div class="relative" x-data="{ open: false }">
                <button @click="open = !open" class="hover:text-yellow-300 font-semibold focus:outline-none flex items-center px-3 py-2 rounded-md">
                    Tools <i class="fas fa-chevron-down ml-1 text-xs"></i>
                </button>
                <div x-show="open" @click.away="open = false"
                     x-transition:enter="transition ease-out duration-100 transform"
                     x-transition:enter-start="opacity-0 scale-95"
                     x-transition:enter-end="opacity-100 scale-100"
                     x-transition:leave="transition ease-in duration-75 transform"
                     x-transition:leave-start="opacity-100 scale-100"
                     x-transition:leave-end="opacity-0 scale-95"
                     class="absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-20 text-gray-700 py-1"
                     style="display: none;" x-cloak>
                     <a href="pdf-editor.html" class="block px-4 py-2 text-sm hover:bg-gray-100">PDF Editor</a>
                     <a href="merge-pdf.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Merge PDF</a>
                     <a href="image-to-pdf.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Image to PDF</a>
                     <a href="pdf-rotator.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Rotate PDF</a>
                     <a href="pdf-text-extractor.html" class="block px-4 py-2 text-sm hover:bg-gray-100">Extract PDF Text</a>
                     <a href="pdf-to-jpg.html" class="block px-4 py-2 text-sm hover:bg-gray-100">PDF to JPG</a>
                     <a href="pdf-to-word.html" class="block px-4 py-2 text-sm hover:bg-gray-100">PDF to Word</a>
                 </div>
             </div>
         </div>
          <!-- Mobile Menu Button -->
          <div class="md:hidden">
              <button @click="mobileMenuOpen = !mobileMenuOpen" class="text-white focus:outline-none p-2 rounded hover:bg-blue-700">
                  <span class="sr-only">Open menu</span>
                  <i x-show="!mobileMenuOpen" class="fa-solid fa-bars text-xl"></i>
                  <i x-show="mobileMenuOpen" class="fa-solid fa-times text-xl" style="display: none;" x-cloak></i>
              </button>
         </div>
    </nav>
     <!-- Mobile Menu Panel -->
     <div x-show="mobileMenuOpen"
         class="md:hidden border-t border-blue-500"
         x-transition:enter="transition ease-out duration-200 transform origin-top"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-100 transform origin-top"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         style="display: none;" x-cloak>
        <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
            <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Home</a>
            <h3 class="px-3 pt-2 text-xs font-semibold text-blue-200 uppercase tracking-wider">Tools</h3>
            <a href="pdf-editor.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">PDF Editor</a>
            <a href="merge-pdf.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Merge PDF</a>
            <a href="image-to-pdf.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Image to PDF</a>
            <a href="pdf-rotator.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Rotate PDF</a>
            <a href="pdf-text-extractor.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Extract PDF Text</a>
            <a href="pdf-to-jpg.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">PDF to JPG</a>
            <a href="pdf-to-word.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">PDF to Word</a>
        </div>
     </div>
</header>
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 mb-3">
                <span class="text-blue-600">PDF</span> to <span class="text-green-600">Word</span> Converter
            </h1>
            <p class="text-gray-600 text-lg">Convert PDF documents to editable Word files with one click</p>
            <div class="flex justify-center items-center mt-4 space-x-2">
                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                    <i class="fas fa-infinity mr-1"></i> No size limit
                </span>
                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                    <i class="fas fa-lock mr-1"></i> Secure processing
                </span>
            </div>
        </header>

        <!-- Main Converter Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-10 p-8">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-semibold text-gray-700 mb-2">Convert PDF to Word</h2>
                <p class="text-gray-500">Drag & drop or click to upload your PDF file</p>
            </div>
            
            <!-- Dropzone -->
            <div id="dropzone" class="dropzone rounded-lg p-8 text-center cursor-pointer mb-8">
                <div id="uploadContent" class="flex flex-col items-center justify-center">
                    <i class="fas fa-file-pdf text-5xl text-red-500 mb-4"></i>
                    <p class="text-gray-500 mb-1">Drag & drop PDF file here</p>
                    <p class="text-sm text-gray-400 mb-4">or</p>
                    <button id="browseBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-full transition">
                        Browse Files
                    </button>
                    <input type="file" id="fileInput" class="hidden" accept=".pdf">
                </div>
                <div id="uploadingContent" class="hidden">
                    <div class="flex items-center justify-center mb-4">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                    </div>
                    <p class="text-gray-700">Converting your PDF to Word...</p>
                    <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
                        <div id="progressBar" class="progress-bar bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="progressText" class="text-sm text-gray-500 mt-2">0% completed</p>
                </div>
            </div>
            
            <!-- Results Section (Hidden Initially) -->
            <div id="resultSection" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-file-word text-3xl text-blue-700 mr-3"></i>
                        <div>
                            <p id="fileName" class="font-medium text-gray-800">document.docx</p>
                            <p id="fileStatus" class="text-sm text-gray-600">Ready for download</p>
                        </div>
                    </div>
                    <button id="downloadBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg text-sm transition flex items-center">
                        <i class="fas fa-download mr-2"></i> Download
                    </button>
                </div>
            </div>
            
            <div id="errorSection" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-circle text-red-500 mr-3"></i>
                    <p id="errorMessage" class="text-red-700">Error converting file</p>
                </div>
            </div>
            
            <!-- Features -->
            <div class="grid grid-cols-2 gap-4 mt-8">
                <div class="flex items-start">
                    <div class="bg-blue-100 p-2 rounded-full mr-3">
                        <i class="fas fa-check-circle text-blue-600"></i>
                    </div>
                    <div>
                        <h3 class="font-medium text-gray-800">No registration</h3>
                        <p class="text-sm text-gray-500">Convert without signing up</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-blue-100 p-2 rounded-full mr-3">
                        <i class="fas fa-clock text-blue-600"></i>
                    </div>
                    <div>
                        <h3 class="font-medium text-gray-800">Fast conversion</h3>
                        <p class="text-sm text-gray-500">Processed in seconds</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-blue-100 p-2 rounded-full mr-3">
                        <i class="fas fa-mobile-alt text-blue-600"></i>
                    </div>
                    <div>
                        <h3 class="font-medium text-gray-800">Mobile friendly</h3>
                        <p class="text-sm text-gray-500">Works on all devices</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="bg-blue-100 p-2 rounded-full mr-3">
                        <i class="fas fa-cloud text-blue-600"></i>
                    </div>
                    <div>
                        <h3 class="font-medium text-gray-800">No storage</h3>
                        <p class="text-sm text-gray-500">Files deleted after conversion</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="text-center text-gray-500 text-sm pt-6 border-t border-gray-200">
            <p>© 2023 PDF to Word Converter. All rights reserved.</p>
            <p class="mt-1">Convert PDF to DOCX format with ease.</p>
        </footer>
    </div>

    <!-- Hidden container for PDF.js processing -->
    <div id="pdfjs-container"></div>

    <script>
        // Initialize PDF.js worker
         // Library Checks
         if (typeof window.pdfjsLib === 'undefined') {
             alert('Error: pdf.js library not loaded. Cannot proceed.'); console.error('pdf.js not loaded');
         } else {
             pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
         }
         if (typeof window.docx === 'undefined') { alert('Error: docx library not loaded. Cannot proceed.'); console.error('docx not loaded'); }
         if (typeof window.saveAs === 'undefined') { console.warn('FileSaver.js not loaded. Download may not work correctly.'); }


         // Make docx available globally if needed
         const docxLib = window.docx;

        document.addEventListener('DOMContentLoaded', function() {
            const dropzone = document.getElementById('dropzone');
            const fileInput = document.getElementById('fileInput');
            const browseBtn = document.getElementById('browseBtn');
            const uploadContent = document.getElementById('uploadContent');
            const uploadingContent = document.getElementById('uploadingContent');
            const resultSection = document.getElementById('resultSection');
            const errorSection = document.getElementById('errorSection');
            const fileNameEl = document.getElementById('fileName'); // Use specific variable name
            const fileStatus = document.getElementById('fileStatus');
            const downloadBtn = document.getElementById('downloadBtn');
            const errorMessage = document.getElementById('errorMessage');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            let currentFile = null;
            let extractedText = '';
            let docxBlob = null;

            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropzone.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false); // Prevent browser opening file
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            // Highlight drop zone when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropzone.addEventListener(eventName, () => dropzone.classList.add('active'), false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropzone.addEventListener(eventName, () => dropzone.classList.remove('active'), false);
            });
            
            // Handle dropped files
            dropzone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length > 0) handleFiles(files[0]); // Handle only the first file dropped
                else showError('No file detected in drop.');
            }
            
            // Browse button click
            browseBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            // File input change
            fileInput.addEventListener('change', function() {
                if (this.files.length) {
                    handleFiles(this.files[0]);
                }
            });
            
            // Handle selected file
            function handleFiles(file) {
                resetState(); // Reset previous results
                currentFile = file;
                
                // Validate file type
                if (!currentFile || (!currentFile.type.includes('pdf') && !currentFile.name.toLowerCase().endsWith('.pdf'))) {
                    showError('Please select a PDF file.');
                    return;
                }
                
                // Display uploading state
                uploadContent.classList.add('hidden');
                uploadingContent.classList.remove('hidden');
                resultSection.classList.add('hidden');
                errorSection.classList.add('hidden');
                updateProgress(0); // Start progress
                
                // Use setTimeout to allow UI repaint before potential heavy lifting
                 setTimeout(() => { convertPDFToDocx(currentFile); }, 100);
             }

             function resetState() {
                  currentFile = null;
                 extractedText = '';
                 docxBlob = null;
                 uploadingContent.classList.add('hidden');
                 uploadContent.classList.remove('hidden');
                 resultSection.classList.add('hidden');
                 errorSection.classList.add('hidden');
                 fileInput.value = null; // Reset file input value
                  updateProgress(0);
                  progressText.textContent = '0% completed';
             }
            
            // Convert PDF to DOCX
            async function convertPDFToDocx(file) {
                try {
                    updateProgress(10, 'Reading file...');
                    const arrayBuffer = await readFileAsArrayBuffer(file);
                    
                    updateProgress(20, 'Loading PDF...');
                    const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
                    const pdf = await loadingTask.promise;
                    
                    let fullText = "";
                    const totalPages = pdf.numPages;
                     updateProgress(30, 'Extracting text...');
                     
                    for (let i = 1; i <= totalPages; i++) {
                         const page = await pdf.getPage(i);
                         const textContent = await page.getTextContent();
                         // Try to maintain paragraph breaks based on y-coordinates
                         let lastY = -1;
                         const lines = textContent.items.map(item => {
                            const yPos = item.transform[5];
                             let prefix = '';
                             if (lastY !== -1 && yPos < lastY - item.height * 1.5) { // Check for significant jump down
                                 prefix = '\n\n'; // Likely new paragraph
                             } else if (lastY !== -1 && yPos < lastY - item.height * 0.5) { // Check for line break
                                 prefix = '\n';
                             }
                            lastY = yPos;
                            return prefix + item.str;
                         }).join('');

                         fullText += lines + "\n\n"; // Page break marker
                         
                         // Update progress during text extraction
                         const progress = 30 + (40 * (i / totalPages));
                         updateProgress(progress, `Extracting page ${i}/${totalPages}...`);
                     }
                    extractedText = fullText;

                    updateProgress(80, 'Generating Word document...');
                     docxBlob = await generateDocx(extractedText);
                    
                    updateProgress(100, 'Conversion complete!');
                    showResult(file);
                    
                } catch (error) {
                    showError('Error converting file: ' + error.message);
                    console.error(error);
                }
            }
            
            // Read file as ArrayBuffer
            function readFileAsArrayBuffer(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                     reader.onload = () => resolve(reader.result);
                     reader.onerror = () => reject(new Error('Failed to read file'));
                     reader.onabort = () => reject(new Error('File reading was aborted'));
                     reader.readAsArrayBuffer(file);
                });
            }

             // Generate DOCX file using docx.js
             async function generateDocx(text) {
                 if (!docxLib) throw new Error("DOCX library not loaded");

                 try {
                     // Attempt to create paragraphs while preserving line breaks
                     const paragraphs = text.split('\n').map(line => {
                         // Handle empty lines by adding an empty paragraph, except for multiple consecutive ones
                         if (line.trim() === '') {
                              return new docxLib.Paragraph({ children: [new docxLib.TextRun('')]});
                         } else {
                             return new docxLib.Paragraph({
                                 children: [
                                    new docxLib.TextRun({ text: line, size: 24 }), // Size 12pt = 24 half-points
                                ],
                                 spacing: { after: 100 }, // Some space after paragraphs
                             });
                         }
                     });

                      // Remove potential excessive empty paragraphs from the end
                     while (paragraphs.length > 1 && paragraphs[paragraphs.length - 1].root[1].root.length === 1 && paragraphs[paragraphs.length - 1].root[1].root[0].root[1].root[1] === undefined) {
                         paragraphs.pop();
                     }

                     const doc = new docxLib.Document({
                         sections: [{
                             properties: {},
                             children: paragraphs,
                         }],
                     });
                    
                     // Generate the DOCX file
                     const blob = await docxLib.Packer.toBlob(doc);
                     return blob;
                 } catch (error) {
                     console.error('Error generating DOCX:', error);
                     throw new Error('Could not generate Word document.');
                 }
             }
            
            // Update progress bar
             function updateProgress(percent, message = null) {
                const clampedPercent = Math.min(percent, 100);
                 progressBar.style.width = `${clampedPercent}%`;
                 progressText.textContent = `${Math.round(clampedPercent)}% completed`;
                 if (message) {
                    // Optionally update a status message element here
                    // Example: statusMessageElement.textContent = message;
                }
             }
            
            // Show conversion result
            function showResult(file) {
                 uploadingContent.classList.add('hidden'); // Hide progress
                 //uploadContent.classList.remove('hidden'); // Option to show upload again
                 resultSection.classList.remove('hidden'); // Show results
                 errorSection.classList.add('hidden');
                
                fileNameEl.textContent = file.name.replace(/\.pdf$/i, '.docx');
                fileStatus.textContent = 'Ready for download';
             }
            
            // Show error
             function showError(message) {
                 uploadingContent.classList.add('hidden');
                 uploadContent.classList.remove('hidden'); // Show upload button again
                 resultSection.classList.add('hidden');
                 errorMessage.textContent = message;
                 errorSection.classList.remove('hidden');
                 
                 // Auto-hide error after some time
                  setTimeout(() => { errorSection.classList.add('hidden'); }, 6000);
             }
            
            // Download button click
            downloadBtn.addEventListener('click', function() {
                 if (!docxBlob || !currentFile) {
                      showError('No DOCX file generated to download.');
                     return;
                  }
                
                 const newName = currentFile.name.replace(/\.pdf$/i, '.docx');
                if(typeof window.saveAs !== 'undefined') {
                    saveAs(docxBlob, newName);
                 } else {
                      console.warn("FileSaver not available. Trying fallback download.");
                      // Fallback download method
                      const url = URL.createObjectURL(docxBlob);
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = newName;
                      document.body.appendChild(a);
                      a.click();
                      document.body.removeChild(a);
                      URL.revokeObjectURL(url);
                 }
            });
        });
    </script>
    <!-- Ad Block -->
    <div class="w-full max-w-4xl mx-auto my-8 text-center">
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9273434855071552"
             crossorigin="anonymous"></script>
        <!-- Reed -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-9273434855071552"
             data-ad-slot="6257062799"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
</body>
</html>